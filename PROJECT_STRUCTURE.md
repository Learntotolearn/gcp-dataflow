# ğŸ“ DataFlow é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸš€ æ ¸å¿ƒç”Ÿäº§æ–‡ä»¶

### ä¸»è¦è„šæœ¬
```
smart_sync_incremental_optimized.py    # ğŸ¯ ä¸»åŒæ­¥è„šæœ¬ (ç”Ÿäº§ç‰ˆæœ¬)
run_optimized_sync.sh                  # ğŸ”§ è¿è¡Œè„šæœ¬
```

### é…ç½®æ–‡ä»¶
```
params-incremental-example.json        # ğŸ“‹ é…ç½®æ¨¡æ¿
params.json                           # âš™ï¸ å®é™…é…ç½®æ–‡ä»¶ (ç”¨æˆ·è‡ªå®šä¹‰)
requirements.txt                      # ğŸ“¦ Pythonä¾èµ–åŒ…
```

### ç®¡ç†å·¥å…·
```
migrate_status_files.py               # ğŸ”„ çŠ¶æ€æ–‡ä»¶è¿ç§»å·¥å…·
test_status_manager.py                # ğŸ“Š çŠ¶æ€ç®¡ç†å’ŒæŸ¥çœ‹å·¥å…·
```

### æ–‡æ¡£
```
README.md                            # ğŸ“– é¡¹ç›®æ¦‚è§ˆå’Œå¿«é€Ÿå¼€å§‹
DATA_SYNC_GUIDE.md                   # ğŸš€ å®Œæ•´ä½¿ç”¨æŒ‡å— (æ¨èé˜…è¯»)
INCREMENTAL_SYNC_SQL_GUIDE.md        # ğŸ” å¢é‡åŒæ­¥SQLè¯¦è§£
INCREMENTAL_SYNC_GUIDE.md            # ğŸ“‹ è¯¦ç»†æŠ€æœ¯æ–‡æ¡£
PROJECT_STRUCTURE.md                 # ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜ (æœ¬æ–‡æ¡£)
```

### è¿è¡Œæ—¶ç›®å½•
```
sync_status/                         # ğŸ’¾ çŠ¶æ€æ–‡ä»¶å­˜å‚¨ç›®å½•
â”œâ”€â”€ {database1}.json                # æ•°æ®åº“1çš„åŒæ­¥çŠ¶æ€
â”œâ”€â”€ {database2}.json                # æ•°æ®åº“2çš„åŒæ­¥çŠ¶æ€
â””â”€â”€ backup_single_table_files/       # æ—§çŠ¶æ€æ–‡ä»¶å¤‡ä»½

logs/                               # ğŸ“ æ—¥å¿—ç›®å½• (è¿è¡Œæ—¶ç”Ÿæˆ)
â”œâ”€â”€ sync_incremental.log            # åŒæ­¥æ—¥å¿—
â””â”€â”€ error.log                       # é”™è¯¯æ—¥å¿—

lib/                                # ğŸ“š åº“æ–‡ä»¶ç›®å½• (å¦‚æœéœ€è¦)
```

---

## ğŸ—„ï¸ å¤‡ä»½ç›®å½•ç»“æ„

### backup/ - éç”Ÿäº§æ–‡ä»¶å­˜å‚¨
```
backup/
â”œâ”€â”€ debug_tools/                    # ğŸ”§ è°ƒè¯•å·¥å…·
â”‚   â””â”€â”€ fix_bigquery_table_conflict.py
â”œâ”€â”€ test_scripts/                   # ğŸ§ª æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ test_multitenant_sync.py
â”‚   â””â”€â”€ verify_multitenant_fix.py
â”œâ”€â”€ deprecated_scripts/             # ğŸ—‘ï¸ åºŸå¼ƒè„šæœ¬
â”œâ”€â”€ traditional_scripts/            # ğŸ“œ ä¼ ç»Ÿè„šæœ¬
â”œâ”€â”€ old_configs/                    # âš™ï¸ æ—§é…ç½®æ–‡ä»¶
â”œâ”€â”€ old_scripts/                    # ğŸ“ æ—§è„šæœ¬
â”œâ”€â”€ analysis_docs/                  # ğŸ“Š åˆ†ææ–‡æ¡£
â”œâ”€â”€ sync_incremental.log            # ğŸ“ å†å²æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ __pycache__/                    # ğŸ—‚ï¸ Pythonç¼“å­˜
â””â”€â”€ README.md                       # ğŸ“– å¤‡ä»½ç›®å½•è¯´æ˜
```

---

## ğŸ¯ æ–‡ä»¶ç”¨é€”è¯´æ˜

### ğŸš€ ç”Ÿäº§ç¯å¢ƒå¿…éœ€æ–‡ä»¶
| æ–‡ä»¶ | ç”¨é€” | é‡è¦æ€§ |
|------|------|--------|
| `smart_sync_incremental_optimized.py` | ä¸»åŒæ­¥è„šæœ¬ | â­â­â­â­â­ |
| `params.json` | é…ç½®æ–‡ä»¶ | â­â­â­â­â­ |
| `requirements.txt` | ä¾èµ–åŒ… | â­â­â­â­â­ |
| `run_optimized_sync.sh` | è¿è¡Œè„šæœ¬ | â­â­â­â­ |

### ğŸ“– æ–‡æ¡£æ–‡ä»¶
| æ–‡ä»¶ | ç”¨é€” | æ¨èé˜…è¯»é¡ºåº |
|------|------|-------------|
| `README.md` | é¡¹ç›®æ¦‚è§ˆ | 1ï¸âƒ£ é¦–å…ˆé˜…è¯» |
| `DATA_SYNC_GUIDE.md` | å®Œæ•´æŒ‡å— | 2ï¸âƒ£ é‡ç‚¹é˜…è¯» |
| `INCREMENTAL_SYNC_SQL_GUIDE.md` | SQLè¯¦è§£ | 3ï¸âƒ£ æ·±å…¥ç†è§£ |
| `INCREMENTAL_SYNC_GUIDE.md` | æŠ€æœ¯æ–‡æ¡£ | 4ï¸âƒ£ å‚è€ƒèµ„æ–™ |

### ğŸ”§ ç®¡ç†å·¥å…·
| æ–‡ä»¶ | ç”¨é€” | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `migrate_status_files.py` | çŠ¶æ€è¿ç§» | ç‰ˆæœ¬å‡çº§æ—¶ |
| `test_status_manager.py` | çŠ¶æ€æŸ¥çœ‹ | æ—¥å¸¸ç›‘æ§ |

### ğŸ—„ï¸ å¤‡ä»½æ–‡ä»¶
| ç›®å½•/æ–‡ä»¶ | ç”¨é€” | è¯´æ˜ |
|-----------|------|------|
| `backup/debug_tools/` | è°ƒè¯•å·¥å…· | é—®é¢˜æ’æŸ¥æ—¶ä½¿ç”¨ |
| `backup/test_scripts/` | æµ‹è¯•è„šæœ¬ | åŠŸèƒ½éªŒè¯æ—¶ä½¿ç”¨ |
| `backup/deprecated_scripts/` | åºŸå¼ƒè„šæœ¬ | å†å²ç‰ˆæœ¬ä¿ç•™ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹æµç¨‹

### 1. é¦–æ¬¡éƒ¨ç½²
```bash
# 1. å¤åˆ¶é…ç½®æ–‡ä»¶
cp params-incremental-example.json params.json

# 2. ç¼–è¾‘é…ç½®
vim params.json

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. è¿è¡ŒåŒæ­¥
python3 smart_sync_incremental_optimized.py
```

### 2. æ—¥å¸¸ä½¿ç”¨
```bash
# å¢é‡åŒæ­¥ (æ¨è)
./run_optimized_sync.sh

# å…¨é‡åŒæ­¥
./run_optimized_sync.sh --full

# æŸ¥çœ‹çŠ¶æ€
python3 test_status_manager.py --overview
```

### 3. é—®é¢˜æ’æŸ¥
```bash
# æŸ¥çœ‹æ—¥å¿—
tail -f logs/sync_incremental.log

# ä½¿ç”¨è°ƒè¯•å·¥å…·
python3 backup/debug_tools/fix_bigquery_table_conflict.py

# è¿è¡Œæµ‹è¯•è„šæœ¬
python3 backup/test_scripts/test_multitenant_sync.py
```

---

## ğŸ“‹ ç»´æŠ¤å»ºè®®

### ğŸ”„ å®šæœŸç»´æŠ¤
- **æ¯å‘¨**: æ£€æŸ¥åŒæ­¥çŠ¶æ€å’Œæ—¥å¿—
- **æ¯æœˆ**: æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
- **æ¯å­£åº¦**: æ£€æŸ¥å¤‡ä»½æ–‡ä»¶ï¼Œæ¸…ç†ä¸éœ€è¦çš„æ–‡ä»¶

### ğŸ—‚ï¸ æ–‡ä»¶ç®¡ç†
- **ä¿ç•™**: æ‰€æœ‰ç”Ÿäº§æ–‡ä»¶å’Œæ–‡æ¡£
- **å®šæœŸæ¸…ç†**: `logs/` ç›®å½•ä¸­çš„æ—§æ—¥å¿—
- **è°¨æ…åˆ é™¤**: `backup/` ç›®å½•ä¸­çš„æ–‡ä»¶

### ğŸ“Š ç›‘æ§è¦ç‚¹
- åŒæ­¥æˆåŠŸç‡
- æ•°æ®é‡å˜åŒ–
- é”™è¯¯æ—¥å¿—
- ç£ç›˜ç©ºé—´ä½¿ç”¨

---

## ğŸ¯ ç‰ˆæœ¬ç®¡ç†

### å½“å‰ç‰ˆæœ¬
- **ç‰ˆæœ¬**: v4.1 (çŠ¶æ€ç®¡ç†ä¼˜åŒ–ç‰ˆ)
- **æ›´æ–°æ—¶é—´**: 2025-09-29
- **çŠ¶æ€**: ç”Ÿäº§å°±ç»ª âœ…

### ç‰ˆæœ¬å†å²
- **v4.1**: æœ¬åœ°çŠ¶æ€å­˜å‚¨ï¼ŒæŒ‰æ•°æ®åº“åˆ†ç»„
- **v4.0**: æ€§èƒ½ä¼˜åŒ–ç‰ˆï¼Œç¼“å­˜å’Œå¹¶è¡Œå¤„ç†
- **v3.x**: ä¼ ç»Ÿç‰ˆæœ¬ (å·²è¿ç§»åˆ° backup/)

---

## ğŸ“ è·å–å¸®åŠ©

### ğŸ“– æ–‡æ¡£ä¼˜å…ˆçº§
1. **README.md** - å¿«é€Ÿäº†è§£é¡¹ç›®
2. **DATA_SYNC_GUIDE.md** - å®Œæ•´ä½¿ç”¨æŒ‡å—
3. **INCREMENTAL_SYNC_SQL_GUIDE.md** - SQLæŸ¥è¯¢è¯¦è§£
4. **INCREMENTAL_SYNC_GUIDE.md** - è¯¦ç»†æŠ€æœ¯æ–‡æ¡£

### ğŸ”§ å·¥å…·ä½¿ç”¨
- **çŠ¶æ€æŸ¥çœ‹**: `python3 test_status_manager.py --overview`
- **çŠ¶æ€è¿ç§»**: `python3 migrate_status_files.py`
- **é—®é¢˜è°ƒè¯•**: æŸ¥çœ‹ `backup/debug_tools/` ä¸­çš„å·¥å…·

### ğŸš¨ ç´§æ€¥æƒ…å†µ
- **åŒæ­¥å¤±è´¥**: æŸ¥çœ‹æ—¥å¿—ï¼Œä½¿ç”¨è°ƒè¯•å·¥å…·
- **æ•°æ®å¼‚å¸¸**: è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯
- **é…ç½®é—®é¢˜**: å‚è€ƒé…ç½®æ¨¡æ¿é‡æ–°è®¾ç½®

---

**é¡¹ç›®æ•´ç†å®Œæˆæ—¶é—´**: 2025-09-29  
**æ•´ç†ç‰ˆæœ¬**: v4.1-clean  
**ç»´æŠ¤çŠ¶æ€**: ç”Ÿäº§å°±ç»ª âœ…